<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>クレセントアイル 宝箱マップ</title>

<link href="https://fonts.googleapis.com/css2?family=M+PLUS+2:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  padding:14px;
  font-family:'M PLUS 2', sans-serif;
  background:#1a2238;
  color:#fff;
}

h2{
  text-align:center;
  margin:6px 0 8px;
}

/* ===== 上部UI ===== */
.top-controls{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  margin-bottom:10px;
  flex-wrap:wrap;
}

.top-controls button{
  font-size:12px;
  padding:5px 10px;
  background:#3a4b6e;
  color:#fff;
  border:1px solid #5a6b8e;
  cursor:pointer;
}

.top-controls button:hover{
  background:#4b5c80;
}

.counter{
  font-size:12px;
  opacity:0.9;
}

.zoom-label{
  font-size:12px;
  opacity:0.9;
  min-width:52px;
  text-align:left;
}

/* ===== マップ ===== */
.map-outer{
  overflow:auto;
}

.map-wrap{
  margin:0 auto;
  width:fit-content;
}

.map-inner{
  position:relative;
}

.map-inner img{
  display:block;
  width:100%;
  border-radius:6px;
}

/* ===== 宝箱 ===== */
.chest{
  position:absolute;
  width:24px;
  height:24px;
  transform:translate(-50%,-50%);
  cursor:pointer;
  background-size:contain;
  background-repeat:no-repeat;
  background-position:center;
}

.chest.copper{
  background-image:url('img/chest_copper.webp');
}

.chest.silver{
  background-image:url('img/chest_silver.webp');
}

.chest.taken{
  opacity:0.5;
}

.chest.taken::after{
  content:"✔";
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:18px;
  color:#7cff7c;
  font-weight:bold;
  opacity:1;
  pointer-events:none;
}

/* ===== 使い方 ===== */
.help{
  margin-top:14px;
  padding:10px;
  background:#243052;
  border-radius:6px;
  font-size:12px;
  line-height:1.6;
  opacity:0.95;
}

/* ===== ズームボタン調整 ===== */
.zoom-group{
  display:flex;
  margin-left: 35px;
}

.zoom-group button{
  width:32px;     /* 横幅を固定 */
  height:28px;    /* 高さを固定 */
  padding:0;
  line-height:28px;
  font-size:16px;
}

/* ＋ − の間だけ隙間をなくす */
.zoom-group button + button{
  margin-left:0;
}

</style>
</head>

<body>

<h2>クレセントアイル:南征編 宝箱チェッカー</h2>

<div class="top-controls">

  <span class="counter" id="copperCount"></span>
  <span class="counter" id="silverCount"></span>
  <button onclick="toggleType('copper')">銅箱 ON/OFF</button>
  <button onclick="toggleType('silver')">銀箱 ON/OFF</button>

  <div class="zoom-group">
    <button onclick="zoomIn()">＋</button>
    <button onclick="zoomOut()">ー</button>
  </div>
  <span class="zoom-label" id="zoomLabel">×1.0</span>
  <button onclick="resetZoom()">ズームリセット</button>

  <button onclick="resetAll()">全取得リセット</button>
</div>

<div class="map-outer">
  <div class="map-wrap">
    <div class="map-inner" id="map">
      <img src="img/map_base.png" alt="map">
    </div>
  </div>
</div>

<div class="help">
<b>使い方</b><br>
・宝箱をクリックすると「取得済み」として記録されます。<br>
・取得状況、表示状態、ズーム倍率は自動的に保存されます。<br>
・銅箱／銀箱ボタンで表示の切り替えができます。<br>
・＋／− ボタンでマップを拡大・縮小できます。<br>
・ズームリセットは倍率のリセット、全取得リセットは宝箱のチェック状態をリセットします。
</div>

<script>
const STORAGE_KEY = 'crescent_map_chests';
const ZOOM_KEY = 'crescent_map_zoom';
const TOGGLE_KEY = 'crescent_map_toggle';

const BASE_WIDTH = 1050;

let zoom = parseFloat(localStorage.getItem(ZOOM_KEY) || '1');
const toggleState = JSON.parse(localStorage.getItem(TOGGLE_KEY) || '{"copper":true,"silver":true}');

const map = document.getElementById('map');
const zoomLabel = document.getElementById('zoomLabel');
const state = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

/* ===== 宝箱データ ===== */
const chests = [
  /* --- 銅箱（60個） --- */
  { id:'c01', type:'copper', top:16.70, left:6.89 },
  { id:'c02', type:'copper', top:14.61, left:14.09 },
  { id:'c03', type:'copper', top:7.52, left:21.29 },
  { id:'c04', type:'copper', top:12.21, left:28.18 },
  { id:'c05', type:'copper', top:21.71, left:17.64 },
  { id:'c06', type:'copper', top:24.22, left:25.89 },
  { id:'c07', type:'copper', top:14.93, left:44.36 },
  { id:'c08', type:'copper', top:31.32, left:33.30 },
  { id:'c09', type:'copper', top:29.65, left:43.22 },
  { id:'c10', type:'copper', top:22.03, left:56.99 },
  { id:'c11', type:'copper', top:13.67, left:68.68 },
  { id:'c12', type:'copper', top:15.87, left:80.27 },
  { id:'c13', type:'copper', top:21.19, left:73.70 },
  { id:'c14', type:'copper', top:26.30, left:82.67 },
  { id:'c15', type:'copper', top:35.80, left:52.61 },
  { id:'c16', type:'copper', top:27.66, left:69.00 },
  { id:'c17', type:'copper', top:35.91, left:67.33 },
  { id:'c18', type:'copper', top:31.52, left:92.90 },
  { id:'c19', type:'copper', top:37.47, left:88.31 },
  { id:'c20', type:'copper', top:32.99, left:16.60 },
  { id:'c21', type:'copper', top:38.62, left:12.53 },
  { id:'c22', type:'copper', top:40.08, left:25.99 },
  { id:'c23', type:'copper', top:43.84, left:41.96 },
  { id:'c24', type:'copper', top:45.41, left:8.14 },
  { id:'c25', type:'copper', top:46.03, left:14.20 },
  { id:'c26', type:'copper', top:51.57, left:28.08 },
  { id:'c27', type:'copper', top:54.91, left:13.05 },
  { id:'c28', type:'copper', top:49.16, left:61.69 },
  { id:'c29', type:'copper', top:45.82, left:73.17 },
  { id:'c30', type:'copper', top:46.66, left:85.59 },
  { id:'c31', type:'copper', top:55.95, left:79.96 },
  { id:'c32', type:'copper', top:55.11, left:88.52 },
  { id:'c33', type:'copper', top:59.39, left:15.24 },
  { id:'c34', type:'copper', top:58.46, left:30.48 },
  { id:'c35', type:'copper', top:56.16, left:37.47 },
  { id:'c36', type:'copper', top:57.52, left:48.64 },
  { id:'c37', type:'copper', top:61.90, left:63.67 },
  { id:'c38', type:'copper', top:66.18, left:30.06 },
  { id:'c39', type:'copper', top:69.62, left:18.79 },
  { id:'c40', type:'copper', top:75.78, left:31.52 },
  { id:'c41', type:'copper', top:71.09, left:50.21 },
  { id:'c42', type:'copper', top:80.58, left:40.40 },
  { id:'c43', type:'copper', top:74.11, left:62.53 },
  { id:'c44', type:'copper', top:81.73, left:51.57 },
  { id:'c45', type:'copper', top:70.04, left:81.42 },
  { id:'c46', type:'copper', top:81.42, left:64.30 },
  { id:'c47', type:'copper', top:76.10, left:73.17 },
  { id:'c48', type:'copper', top:71.29, left:90.40 },
  { id:'c49', type:'copper', top:78.50, left:92.48 },
  { id:'c50', type:'copper', top:83.92, left:90.92 },
  { id:'c51', type:'copper', top:80.79, left:78.81 },
  { id:'c52', type:'copper', top:83.30, left:71.19 },
  { id:'c53', type:'copper', top:87.89, left:56.68 },
  { id:'c54', type:'copper', top:89.25, left:38.94 },
  { id:'c55', type:'copper', top:80.58, left:23.17 },
  { id:'c56', type:'copper', top:77.04, left:13.99 },
  { id:'c57', type:'copper', top:84.13, left:11.17 },
  { id:'c58', type:'copper', top:89.56, left:21.09 },
  { id:'c59', type:'copper', top:81.21, left:17.64 },
  { id:'c60', type:'copper', top:89.25, left:15.34 },

  /* --- 銀箱（仮配置） --- */
  { id:'s01', type:'silver', top:9.29, left:9.39 },
  { id:'s02', type:'silver', top:34.86, left:11.06 },
  { id:'s03', type:'silver', top:40.50, left:16.81 },
  { id:'s04', type:'silver', top:43.22, left:87.68 },
  { id:'s05', type:'silver', top:61.90, left:75.37 },
  { id:'s06', type:'silver', top:68.58, left:36.22 },
  { id:'s07', type:'silver', top:79.23, left:84.24 },
  { id:'s08', type:'silver', top:84.76, left:18.16 },
];

/* ===== 初期化 ===== */
applyZoom();

chests.forEach(c=>{
  const d = document.createElement('div');
  d.className = `chest ${c.type}`;
  d.style.top  = c.top + '%';
  d.style.left = c.left + '%';

  if(state[c.id]) d.classList.add('taken');
  if(!toggleState[c.type]) d.style.display='none';

  d.addEventListener('click',()=>{
    d.classList.toggle('taken');
    state[c.id] = d.classList.contains('taken');
    save();
    updateCounters();
  });

  map.appendChild(d);
});

updateCounters();

/* ===== 保存 ===== */
function save(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* ===== カウンター ===== */
function updateCounters(){
  const copperAll = chests.filter(c=>c.type==='copper').length;
  const silverAll = chests.filter(c=>c.type==='silver').length;

  const copperGot = Object.keys(state).filter(id=>id.startsWith('c') && state[id]).length;
  const silverGot = Object.keys(state).filter(id=>id.startsWith('s') && state[id]).length;

  document.getElementById('copperCount').textContent =
    `銅箱 [${copperGot} / ${copperAll}]`;
  document.getElementById('silverCount').textContent =
    `銀箱 [${silverGot} / ${silverAll}]`;
}

/* ===== 表示切替 ===== */
function toggleType(type){
  toggleState[type] = !toggleState[type];
  document.querySelectorAll(`.chest.${type}`).forEach(c=>{
    c.style.display = toggleState[type] ? '' : 'none';
  });
  localStorage.setItem(TOGGLE_KEY, JSON.stringify(toggleState));
}

/* ===== ズーム ===== */
function zoomIn(){
  zoom = Math.min(zoom + 0.1, 2.5);
  applyZoom();
}

function zoomOut(){
  zoom = Math.max(zoom - 0.1, 0.5);
  applyZoom();
}

function resetZoom(){
  zoom = 1;
  applyZoom();
}

function applyZoom(){
  map.style.width = (BASE_WIDTH * zoom) + 'px';
  zoomLabel.textContent = `×${zoom.toFixed(1)}`;
  localStorage.setItem(ZOOM_KEY, zoom);
}

/* ===== 全リセット ===== */
function resetAll(){
  if(!confirm('全ての宝箱を未取得状態に戻しますか？')) return;
  document.querySelectorAll('.chest').forEach(c=>c.classList.remove('taken'));
  localStorage.removeItem(STORAGE_KEY);
  updateCounters();
}
</script>

</body>
</html>
